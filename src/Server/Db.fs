// AUTO-GENERATED by src/Gen/Program.fs -- do not edit by hand.
module Server.Db

open Hedge.Workers

// ============================================================
// Guest (guests)
// ============================================================

type GuestRow = {
    Id: string
    Name: string
    Picture: string
    SessionId: string
    CreatedAt: int
    DeletedAt: int option
}

type GuestCreate = {
    Name: string
    Picture: string
    SessionId: string
}

let parseGuestRow (row: obj) : GuestRow =
    { Id = rowStr row "id"
      Name = rowStr row "name"
      Picture = rowStr row "picture"
      SessionId = rowStr row "session_id"
      CreatedAt = rowInt row "created_at"
      DeletedAt = rowIntOpt row "deleted_at" }

let selectGuests (db: D1Database) : D1PreparedStatement =
    db.prepare("SELECT id, name, picture, session_id, created_at, deleted_at FROM guests ORDER BY created_at DESC LIMIT 100")

let selectGuest (id: string) (db: D1Database) : D1PreparedStatement =
    bind (db.prepare("SELECT id, name, picture, session_id, created_at, deleted_at FROM guests WHERE id = ?")) [| box id |]

let insertGuest (db: D1Database) (create: GuestCreate) =
    let id = newId()
    let now = epochNow()
    let stmt =
        bind (db.prepare("INSERT INTO guests (id, name, picture, session_id, created_at) VALUES (?, ?, ?, ?, ?)"))
             [| box id; box create.Name; box create.Picture; box create.SessionId; box now |]
    {| Stmt = stmt; Id = id; CreatedAt = now |}

let updateGuest (id: string) (create: GuestCreate) (db: D1Database) : D1PreparedStatement =
    bind (db.prepare("UPDATE guests SET name = ?, picture = ?, session_id = ? WHERE id = ?"))
         [| box create.Name; box create.Picture; box create.SessionId; box id |]

let deleteGuest (id: string) (db: D1Database) : D1PreparedStatement =
    bind (db.prepare("DELETE FROM guests WHERE id = ?")) [| box id |]

// ============================================================
// MicroblogItem (items)
// ============================================================

type MicroblogItemRow = {
    Id: string
    Title: string
    Link: string option
    Image: string option
    Extract: string option
    OwnerComment: string
    CreatedAt: int
    UpdatedAt: int option
    ViewCount: int
    DeletedAt: int option
}

type MicroblogItemCreate = {
    Title: string
    Link: string option
    Image: string option
    Extract: string option
    OwnerComment: string
    ViewCount: int
}

let parseMicroblogItemRow (row: obj) : MicroblogItemRow =
    { Id = rowStr row "id"
      Title = rowStr row "title"
      Link = rowStrOpt row "link"
      Image = rowStrOpt row "image"
      Extract = rowStrOpt row "extract"
      OwnerComment = rowStr row "owner_comment"
      CreatedAt = rowInt row "created_at"
      UpdatedAt = rowIntOpt row "updated_at"
      ViewCount = rowInt row "view_count"
      DeletedAt = rowIntOpt row "deleted_at" }

let selectMicroblogItems (db: D1Database) : D1PreparedStatement =
    db.prepare("SELECT id, title, link, image, extract, owner_comment, created_at, updated_at, view_count, deleted_at FROM items ORDER BY created_at DESC LIMIT 100")

let selectMicroblogItem (id: string) (db: D1Database) : D1PreparedStatement =
    bind (db.prepare("SELECT id, title, link, image, extract, owner_comment, created_at, updated_at, view_count, deleted_at FROM items WHERE id = ?")) [| box id |]

let insertMicroblogItem (db: D1Database) (create: MicroblogItemCreate) =
    let id = newId()
    let now = epochNow()
    let stmt =
        bind (db.prepare("INSERT INTO items (id, title, link, image, extract, owner_comment, view_count, created_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?)"))
             [| box id; box create.Title; optToDb create.Link; optToDb create.Image; optToDb create.Extract; box create.OwnerComment; box create.ViewCount; box now |]
    {| Stmt = stmt; Id = id; CreatedAt = now |}

let updateMicroblogItem (id: string) (create: MicroblogItemCreate) (db: D1Database) : D1PreparedStatement =
    let now = epochNow()
    bind (db.prepare("UPDATE items SET title = ?, link = ?, image = ?, extract = ?, owner_comment = ?, view_count = ?, updated_at = ? WHERE id = ?"))
         [| box create.Title; optToDb create.Link; optToDb create.Image; optToDb create.Extract; box create.OwnerComment; box create.ViewCount; box now; box id |]

let deleteMicroblogItem (id: string) (db: D1Database) : D1PreparedStatement =
    bind (db.prepare("DELETE FROM items WHERE id = ?")) [| box id |]

// ============================================================
// ItemComment (comments)
// ============================================================

type ItemCommentRow = {
    Id: string
    ItemId: string
    GuestId: string
    ParentId: string option
    Author: string
    Content: string
    Removed: bool
    CreatedAt: int
    DeletedAt: int option
}

type ItemCommentCreate = {
    ItemId: string
    GuestId: string
    ParentId: string option
    Author: string
    Content: string
    Removed: bool
}

let parseItemCommentRow (row: obj) : ItemCommentRow =
    { Id = rowStr row "id"
      ItemId = rowStr row "item_id"
      GuestId = rowStr row "guest_id"
      ParentId = rowStrOpt row "parent_id"
      Author = rowStr row "author"
      Content = rowStr row "content"
      Removed = rowBool row "removed"
      CreatedAt = rowInt row "created_at"
      DeletedAt = rowIntOpt row "deleted_at" }

let selectItemComments (db: D1Database) : D1PreparedStatement =
    db.prepare("SELECT id, item_id, guest_id, parent_id, author, content, removed, created_at, deleted_at FROM comments ORDER BY created_at DESC LIMIT 100")

let selectItemComment (id: string) (db: D1Database) : D1PreparedStatement =
    bind (db.prepare("SELECT id, item_id, guest_id, parent_id, author, content, removed, created_at, deleted_at FROM comments WHERE id = ?")) [| box id |]

let insertItemComment (db: D1Database) (create: ItemCommentCreate) =
    let id = newId()
    let now = epochNow()
    let stmt =
        bind (db.prepare("INSERT INTO comments (id, item_id, guest_id, parent_id, author, content, removed, created_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?)"))
             [| box id; box create.ItemId; box create.GuestId; optToDb create.ParentId; box create.Author; box create.Content; box create.Removed; box now |]
    {| Stmt = stmt; Id = id; CreatedAt = now |}

let updateItemComment (id: string) (create: ItemCommentCreate) (db: D1Database) : D1PreparedStatement =
    bind (db.prepare("UPDATE comments SET item_id = ?, guest_id = ?, parent_id = ?, author = ?, content = ?, removed = ? WHERE id = ?"))
         [| box create.ItemId; box create.GuestId; optToDb create.ParentId; box create.Author; box create.Content; box create.Removed; box id |]

let deleteItemComment (id: string) (db: D1Database) : D1PreparedStatement =
    bind (db.prepare("DELETE FROM comments WHERE id = ?")) [| box id |]

let selectItemCommentsByItemId (itemId: string) (db: D1Database) : D1PreparedStatement =
    bind (db.prepare("SELECT id, item_id, guest_id, parent_id, author, content, removed, created_at, deleted_at FROM comments WHERE item_id = ? ORDER BY created_at DESC LIMIT 100")) [| box itemId |]

let selectItemCommentsByGuestId (guestId: string) (db: D1Database) : D1PreparedStatement =
    bind (db.prepare("SELECT id, item_id, guest_id, parent_id, author, content, removed, created_at, deleted_at FROM comments WHERE guest_id = ? ORDER BY created_at DESC LIMIT 100")) [| box guestId |]

// ============================================================
// Tag (tags)
// ============================================================

type TagRow = {
    Id: string
    Name: string
    CreatedAt: int
    DeletedAt: int option
}

type TagCreate = {
    Name: string
}

let parseTagRow (row: obj) : TagRow =
    { Id = rowStr row "id"
      Name = rowStr row "name"
      CreatedAt = rowInt row "created_at"
      DeletedAt = rowIntOpt row "deleted_at" }

let selectTags (db: D1Database) : D1PreparedStatement =
    db.prepare("SELECT id, name, created_at, deleted_at FROM tags ORDER BY created_at DESC LIMIT 100")

let selectTag (id: string) (db: D1Database) : D1PreparedStatement =
    bind (db.prepare("SELECT id, name, created_at, deleted_at FROM tags WHERE id = ?")) [| box id |]

let insertTag (db: D1Database) (create: TagCreate) =
    let id = newId()
    let now = epochNow()
    let stmt =
        bind (db.prepare("INSERT INTO tags (id, name, created_at) VALUES (?, ?, ?)"))
             [| box id; box create.Name; box now |]
    {| Stmt = stmt; Id = id; CreatedAt = now |}

let updateTag (id: string) (create: TagCreate) (db: D1Database) : D1PreparedStatement =
    bind (db.prepare("UPDATE tags SET name = ? WHERE id = ?"))
         [| box create.Name; box id |]

let deleteTag (id: string) (db: D1Database) : D1PreparedStatement =
    bind (db.prepare("DELETE FROM tags WHERE id = ?")) [| box id |]

// ============================================================
// ItemTag (item_tags)
// ============================================================

type ItemTagRow = {
    ItemId: string
    TagId: string
    DeletedAt: int option
}

type ItemTagCreate = {
    ItemId: string
    TagId: string
}

let parseItemTagRow (row: obj) : ItemTagRow =
    { ItemId = rowStr row "item_id"
      TagId = rowStr row "tag_id"
      DeletedAt = rowIntOpt row "deleted_at" }

let selectItemTags (db: D1Database) : D1PreparedStatement =
    db.prepare("SELECT item_id, tag_id, deleted_at FROM item_tags LIMIT 100")

let selectItemTag (id: string) (db: D1Database) : D1PreparedStatement =
    bind (db.prepare("SELECT item_id, tag_id, deleted_at FROM item_tags WHERE item_id = ?")) [| box id |]

let insertItemTag (db: D1Database) (create: ItemTagCreate) =
    let stmt =
        bind (db.prepare("INSERT INTO item_tags (item_id, tag_id) VALUES (?, ?)"))
             [| box create.ItemId; box create.TagId |]
    {| Stmt = stmt |}

let updateItemTag (id: string) (create: ItemTagCreate) (db: D1Database) : D1PreparedStatement =
    bind (db.prepare("UPDATE item_tags SET item_id = ?, tag_id = ? WHERE item_id = ?"))
         [| box create.ItemId; box create.TagId; box id |]

let deleteItemTag (id: string) (db: D1Database) : D1PreparedStatement =
    bind (db.prepare("DELETE FROM item_tags WHERE item_id = ?")) [| box id |]

let selectItemTagsByItemId (itemId: string) (db: D1Database) : D1PreparedStatement =
    bind (db.prepare("SELECT item_id, tag_id, deleted_at FROM item_tags WHERE item_id = ? LIMIT 100")) [| box itemId |]

let selectItemTagsByTagId (tagId: string) (db: D1Database) : D1PreparedStatement =
    bind (db.prepare("SELECT item_id, tag_id, deleted_at FROM item_tags WHERE tag_id = ? LIMIT 100")) [| box tagId |]

// ============================================================
// GuestSession (guest_sessions)
// ============================================================

type GuestSessionRow = {
    GuestId: string
    DisplayName: string
    CreatedAt: int
}

type GuestSessionCreate = {
    GuestId: string
    DisplayName: string
    CreatedAt: int
}

let parseGuestSessionRow (row: obj) : GuestSessionRow =
    { GuestId = rowStr row "guest_id"
      DisplayName = rowStr row "display_name"
      CreatedAt = rowInt row "created_at" }

let selectGuestSessions (db: D1Database) : D1PreparedStatement =
    db.prepare("SELECT guest_id, display_name, created_at FROM guest_sessions ORDER BY created_at DESC LIMIT 100")

let selectGuestSession (id: string) (db: D1Database) : D1PreparedStatement =
    bind (db.prepare("SELECT guest_id, display_name, created_at FROM guest_sessions WHERE guest_id = ?")) [| box id |]

let insertGuestSession (db: D1Database) (create: GuestSessionCreate) =
    let stmt =
        bind (db.prepare("INSERT INTO guest_sessions (guest_id, display_name, created_at) VALUES (?, ?, ?)"))
             [| box create.GuestId; box create.DisplayName; box create.CreatedAt |]
    {| Stmt = stmt |}

let updateGuestSession (id: string) (create: GuestSessionCreate) (db: D1Database) : D1PreparedStatement =
    bind (db.prepare("UPDATE guest_sessions SET guest_id = ?, display_name = ?, created_at = ? WHERE guest_id = ?"))
         [| box create.GuestId; box create.DisplayName; box create.CreatedAt; box id |]

let deleteGuestSession (id: string) (db: D1Database) : D1PreparedStatement =
    bind (db.prepare("DELETE FROM guest_sessions WHERE guest_id = ?")) [| box id |]
