// AUTO-GENERATED by src/Gen/Program.fs -- do not edit by hand.
module Server.Routes

open Fable.Core
open Thoth.Json
open Hedge.Workers
open Hedge.Router
open Codecs
open Server.Env

let dispatch (request: WorkerRequest) (env: Env) (ctx: ExecutionContext)
    : JS.Promise<WorkerResponse> option =
    let route = parseRoute request
    match route with
    | GET path when matchPath "/api/tags" path = Some (Exact "/api/tags") ->
        Some (Server.Handlers.getTags env)

    | GET path when matchPath "/api/feed" path = Some (Exact "/api/feed") ->
        Some (Server.Handlers.getFeed env)

    | GET path ->
        match matchPath "/api/tags/:id/items" path with
        | Some (WithParam (_, id)) -> Some (Server.Handlers.getItemsByTag id env)
        | _ ->
        match matchPath "/api/item/:id" path with
        | Some (WithParam (_, id)) -> Some (Server.Handlers.getItem id env)
        | _ ->
        None

    | POST path when matchPath "/api/item" path = Some (Exact "/api/item") ->
        Some (promise {
            let! bodyText = request.text()
            match Decode.fromString Decode.submitItemReq bodyText with
            | Error err -> return badRequest err
            | Ok req ->
                return! Server.Handlers.submitItem req request env ctx
        })

    | POST path when matchPath "/api/comment" path = Some (Exact "/api/comment") ->
        Some (promise {
            let! bodyText = request.text()
            match Decode.fromString Decode.submitCommentReq bodyText with
            | Error err -> return badRequest err
            | Ok req ->
                return! Server.Handlers.submitComment req request env ctx
        })

    | _ -> None
